import{_ as e,o as t,c as i,d as a}from"./app-CFIaTHNp.js";const r="/assets/388303814279280-7_xZjDGr.png",s="/assets/231835696836803-DaeThncL.png",n="/assets/382107205625895-DY4YHJYK.png",d="/assets/424924709279287-Bh8lYXl6.png",l={},o=a('<h1 id="zerotier" tabindex="-1"><a class="header-anchor" href="#zerotier" aria-hidden="true">#</a> zerotier</h1><blockquote><p>https://stray.love/jiao-cheng/zerotier-zhong-jie-jiao-cheng https://zhuanlan.zhihu.com/p/383471270</p></blockquote><p>使用zerotier完成内网穿透</p><p>优点：无需公网ip，即可大概率p2p打通 缺点：移动的设备需要每台设备都安装客户端， 固定的设备可通过路由器安装zerotier直接管理</p><h2 id="实战配置" tabindex="-1"><a class="header-anchor" href="#实战配置" aria-hidden="true">#</a> 实战配置</h2><p>zerotier安装在路由器时，可以自动管理 但是路由器装不了， 所以被迫安装到了n1盒子上，也可以通过设置路由表进行管理</p><p>网络情况如下：</p><p>hz ，路由器lan 192.168.5.1/24 安装zerotier客户端，分配虚拟ip 10.144.250.49 wz, 路由器lan 192.168.2.1/24 不能装zerotier客户端， 由局域网设备n1（192.168.2.190）安装，并分配虚拟ip 10.144.199.120</p><h3 id="_1-zerotier-配置" tabindex="-1"><a class="header-anchor" href="#_1-zerotier-配置" aria-hidden="true">#</a> 1 zerotier 配置</h3><h4 id="_1-1设置路由" tabindex="-1"><a class="header-anchor" href="#_1-1设置路由" aria-hidden="true">#</a> 1.1设置路由</h4><p><img src="'+r+'" alt=""></p><h3 id="_1-2-设置这两个设备允许-allow-ethernet-bridging" tabindex="-1"><a class="header-anchor" href="#_1-2-设置这两个设备允许-allow-ethernet-bridging" aria-hidden="true">#</a> 1.2 设置这两个设备允许 Allow Ethernet Bridging</h3><p><img src="'+s+'" alt=""></p><p>zerotier 设置结束</p><h3 id="_2-客户端设置" tabindex="-1"><a class="header-anchor" href="#_2-客户端设置" aria-hidden="true">#</a> 2 客户端设置</h3><h4 id="_2-1-路由器客户端设置" tabindex="-1"><a class="header-anchor" href="#_2-1-路由器客户端设置" aria-hidden="true">#</a> 2.1 路由器客户端设置</h4><p>路由器可傻瓜配置，只需要勾选 &quot;自动允许客户端 NAT&quot; 即可 <img src="'+n+`" alt=""></p><h4 id="_2-2-n1盒子设置" tabindex="-1"><a class="header-anchor" href="#_2-2-n1盒子设置" aria-hidden="true">#</a> 2.2 n1盒子设置</h4><p>n1盒子没有提供简单的web ui界面， 因此需要手动管理路由表</p><p>首先使用 <strong>zerotier-cli listnetworks</strong> 命令， 查看网卡id</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@aml:~# zerotier-cli listnetworks
200 listnetworks &lt;nwid&gt; &lt;name&gt; &lt;mac&gt; &lt;status&gt; &lt;type&gt; &lt;dev&gt; &lt;ZT assigned ips&gt;
200 listnetworks 8bd5124fd6c7fc63 zt-home 62:0f:bf:0d:13:f1 OK PRIVATE zt0 10.144.199.120/16
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>PRIVATE 后面的<mark>zt0</mark>是网卡id</p><p>第一步，打开盒子的网络转发功能</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#临时生效
echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward
#永久生效，需要修改sysctl.conf，然后执行sysctl -p
net.ipv4.ip_forward = 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来，处理防火墙规则</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo iptables -A FORWARD -i zt0 -j ACCEPT
sudo iptables -A FORWARD -o zt0 -j ACCEPT
sudo iptables -t nat -A POSTROUTING  ! -o lo -j MASQUERADE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>2023 10月16日， 发现这样的规则会导致该设备离线后其他设备不会通过网关访问其他设备，而是通过该设备，很尴尬 <img src="`+d+`" alt=""></p></blockquote><p>这里 zt0 为zerotier虚拟网卡 保存iptable规则</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo apt-get install iptables-persistent
sudo sh -c &quot;iptables-save &gt; /etc/iptables/rules.v4&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,29),c=[o];function p(h,u){return t(),i("div",null,c)}const g=e(l,[["render",p],["__file","zerotier.html.vue"]]);export{g as default};
