import{_ as i,o as a,c as e,d as s}from"./app-CFIaTHNp.js";const t="/assets/20210706000854738_8657-D8LI9nHB.png",n="data:image/png;base64,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",c="/assets/20210710111354832_28033-B3ohXKNs.png",o="/assets/20210710111622380_22277-CuTGbDjH.png",r="/assets/20210710111717516_31301-COesxhGj.png",l="/assets/20210710111828345_24528-DBXVuKSz.png",d="/assets/20210712122439699_5581-DA2MSkqN.png",p="/assets/20210712122457899_22964-D7Mdr-Kb.png",A="/assets/20210712122339853_29496-BYdvhLGt.png",h={},u=s('<h1 id="oceanus" tabindex="-1"><a class="header-anchor" href="#oceanus" aria-hidden="true">#</a> oceanus</h1><h2 id="操作步骤" tabindex="-1"><a class="header-anchor" href="#操作步骤" aria-hidden="true">#</a> 操作步骤</h2><ol><li>oceaus 平台建表, 包括海力方表和ch表, 其中要注意ch表写入时间(一般60)和写入量(10000+)</li><li>新建任务</li><li>申请资源</li><li>运行任务</li></ol><p>问题汇总</p><h2 id="问题1" tabindex="-1"><a class="header-anchor" href="#问题1" aria-hidden="true">#</a> 问题1</h2><p>复制海力方表的tid过去后, 自动填充的字段类型有错误,需要手动检查修改</p><h2 id="问题2" tabindex="-1"><a class="header-anchor" href="#问题2" aria-hidden="true">#</a> 问题2</h2><p>类型正确后, 启动任务不闪退了,但是没数据, 查看日志发现连接本地ch数据库出了问题 3. <img src="'+t+'" alt=""> 通过百度了解到tcp端口为9000, 默认的http端口为8123, 但是我这里是修改过的, 因此是8080</p><p>修改为自定义的8080端口, ok</p><h2 id="问题3" tabindex="-1"><a class="header-anchor" href="#问题3" aria-hidden="true">#</a> 问题3:</h2><p>使用select count(*) 查询数据量正常, 但是select sum(rows) 显示的数量要大的多</p><p><img src="'+n+'" alt=""></p><p><img src="'+c+'" alt=""></p><p>查找后发现是因为数据写入太快, 导致分区过多 可以看到前几天的数据都是一个分区, 这是ch后台合并的结果 <img src="'+o+'" alt=""></p><p>但是查看当天的数据, 发现分了好多区,并且每一块都很小 <img src="'+r+'" alt=""></p><p>发现是写入es批量太小, 且写入太快导致的</p><ol><li>增大批量写条目数, 设置为100000(默认为1000), 如果表过大, 可调整</li><li>增大flush时间间隔 设置为60s(默认为1) https://oceanus.oa.com/#/table/list <img src="'+l+'" alt=""></li></ol><p><img src="'+d+'" alt="优化前"></p><p>优化后 <img src="'+p+`" alt="优化后"> 查询语句</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SELECT 
    table,
    partition,
    sum(rows) AS row
FROM system.parts
WHERE (database = &#39;situation_awareness&#39;) AND (table = &#39;weilidai_antiCollection_socialUniformity_oceanus&#39;)
GROUP BY 
    table,
    partition
    WITH TOTALS
ORDER BY partition ASC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="问题4-数据消费问题" tabindex="-1"><a class="header-anchor" href="#问题4-数据消费问题" aria-hidden="true">#</a> 问题4 数据消费问题</h2><p>需设置savepoint, 防止重启任务时中间数据丢失问题</p><h2 id="问题5-导出至clickhouse数据库" tabindex="-1"><a class="header-anchor" href="#问题5-导出至clickhouse数据库" aria-hidden="true">#</a> 问题5 导出至clickhouse数据库</h2><p>官方文档中有说明, 只有1.14版本支持导出</p><p>https://iwiki.woa.com/pages/viewpage.action?pageId=746586889</p><p>https://iwiki.woa.com/pages/viewpage.action?pageId=703323873</p><p><img src="`+A+'" alt=""></p>',27),b=[u];function m(g,C){return a(),e("div",null,b)}const I=i(h,[["render",m],["__file","oceanus.html.vue"]]);export{I as default};
